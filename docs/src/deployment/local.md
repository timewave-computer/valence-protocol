# Local interchain deployment

In order to test a program locally, we use the local interchaintest suite to spin up chains.

## 1. Installing local-interchain

Before you can run the tests, you need to install Local interchain. This is a one-time operation. NOTE: your binary will link back to the location of where you install, if you remove the folder, you need to `make install` the binary again.

```bash
git clone https://github.com/strangelove-ventures/interchaintest && cd interchaintest/local-interchain && make install
```

## 2. Running your local environment

Run one of the set-up configs we have in the `local-interchaintest/chains` folder. For example, to run the `neutron.json` config, run the following command inside the `local-interchaintest` folder:

```bash
local-ic start neutron --api-port 42069
```

This will start a local environment with a Gaia chain and a Neutron (using ICS) chain. The `--api-port` will expose the API on port 42069, we are using this port in our local-ic-utils crate so let's use the same to reuse some of the utils there.

## 3. Optimize Contracts

Use CosmWasm optimizer to optimize contracts and store the results in `./artifacts`

```bash
just optimize
```

Or

```bash
./devtools/optimize.sh
```

## 4. Generate manager config

Before we can deploy a program using the manager, we need to generate a manager config.

```bash
cargo run -p generate_local_ic_config
```

The default chain config that is used in this script is the `neutron.json` config, if in step 2 you started local-ic with a different chain config, please use the same config here.

Example with `neutron_juno.json` chain config:

```bash
cargo run -p generate_local_ic_config -- -c neutron_juno
```

## 5. Build program config

Before deploying a program, we need to build the program config.

This script is taking the program you build using the Program Builder in `my_program.rs` and output the program config in a JSON format in `output_program/program.json`.

```bash
cargo run -p build_program
```

* This script is a helper to generate a program config in JSON format using our program builder in rust, a program config in JSON format can be generated in any other method.

## 6. Deploy a program

To deploy a program, you can use the `deploy_program` script.

To run this script you need a manager config and a program config:

- Manager config is generated by `generate_local_ic_config` script for local environment.
- Program config can be generated using the `build_program` script or any other method.

```bash
cargo run -p deploy_program
```

By default it will look for the program config generated in by the `build_program` script in `output_program/program.json`, you can pass a different path to the config:

```bash
cargo run -p deploy_program -- -p path/to/program_config.json
```

## 7. Program Instantiated

After a program was instantiated successfully, you will see a success message in the console and the program config file path that was generated.

The name of the file will end with the program id, for example: `program_1.json`.

You will be able to find this file under the `deployment/results` folder.